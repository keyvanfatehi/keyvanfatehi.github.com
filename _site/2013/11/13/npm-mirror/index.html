
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>How to setup an NPM mirror</title>
    
    <meta name="author" content="Keyvan Fatehi">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>
    <div class="navbar">
      <div class="navbar-inner">
        <div class="container-narrow">
          <a class="brand" href="/">logbay of eyvankay</a>
          <ul class="nav">
            
            
            


  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container-narrow">

      <div class="content">
        
<div class="page-header">
  <h1>How to setup an NPM mirror </h1>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="date">
      <span>13 November 2013</span>
    </div>
    <div class="content">
      <p>This tutorial is largely based on <a href='http://clock.co.uk/tech-blogs/how-to-create-a-private-npmjs-repository'>this other tutorial</a>.</p>

<p>First off make sure you have a large enough disk drive, I&#8217;ll update once my replication is up to date, currently it&#8217;s only at 2 GB after running for about 10 minutes.</p>

<h1 id='install__configure_couchdb'>Install &amp; Configure CouchDB</h1>

<h2 id='on_mac_os_x'>On Mac OS X</h2>

<ol>
<li>Use Homebrew to install couchdb: <code>brew install couchdb</code> read the caveats to make it autostart on reboots</li>

<li>Point your browser to the CouchDB configuration page which should now be available at <a href='http://127.0.0.1:5984/_utils/index.html'>http://127.0.0.1:5984/_utils/index.html</a></li>

<li>Click &#8220;Configuration&#8221; and find <code>secure_rewrites</code> and set it to <code>false</code></li>
</ol>

<h2 id='on_a_raspberry_pi_w_arch_linux'>On a Raspberry Pi w/ Arch Linux</h2>

<ol>
<li>Grab the Arch image from <a href='http://www.raspberrypi.org/downloads'>http://www.raspberrypi.org/downloads</a></li>

<li>Determine the device path for your SD card with <code>df</code> at the terminal.</li>

<li>Unzip and then <code>dd</code> the image to path you found: <code>sudo dd bs=4m
if=/path/to/img of=/dev/mysd</code> make sure you point to the card and not the partition (e.g. /dev/disk1, not /dev/disk1s1)</li>

<li>Install couchdb &#8211; still doing this &#8211; will update after I learn to use <code>pacman</code></li>
</ol>

<h1 id='tell_couchdb_to_replicate_continuously_from_npm'>Tell CouchDB to replicate continuously from NPM</h1>

<p>Open terminal and enter the following to setup continuous replication from the official npm registry:</p>

<p><code>
curl -X POST http://127.0.0.1:5984/_replicate -d &#39;{&quot;source&quot;:&quot;http://isaacs.iriscouch.com/registry/&quot;, &quot;target&quot;:&quot;registry&quot;, &quot;continuous&quot;:true, &quot;create_target&quot;:true}&#39; -H &quot;Content-Type: application/json&quot; 
</code></p>

<h1 id='tell_couchdb_to_stop_replicating'>Tell CouchDB to stop replicating</h1>

<p>In case you ever need it:</p>

<p><code>
curl -X POST http://127.0.0.1:5984/_replicate -d &#39;{&quot;source&quot;:&quot;http://isaacs.iriscouch.com/registry/&quot;, &quot;target&quot;:&quot;registry&quot;, &quot;continuous&quot;:true, &quot;create_target&quot;:true, &quot;cancel&quot;:true}&#39; -H &quot;Content-Type: application/json&quot; 
</code></p>

<h1 id='finalizing_the_installation'>Finalizing the installation</h1>

<p>This information can also be found here <a href='https://github.com/isaacs/npmjs.org'>https://github.com/isaacs/npmjs.org</a>. That link will also explain how to tell <code>npm</code> to use your new registry.</p>

<p><code>
git clone git://github.com/isaacs/npmjs.org.git
cd npmjs.org
sudo npm install -g couchapp 
npm install couchapp 
npm install semver 
couchapp push registry/app.js http://localhost:5984/registry 
couchapp push www/app.js http://localhost:5984/registry 
</code></p>

<h1 id='testing_the_installation'>Testing the installation</h1>

<p><code>
npm --registry http://localhost:5984/registry/_design/scratch/_rewrite login
npm --registry http://localhost:5984/registry/_design/scratch/_rewrite search
</code></p>
    </div>

    

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
     
    	<li><a href="/tags.html#npm couchdb-ref">npm couchdb <span>1</span></a></li>
    
  



    </ul>
    

    <hr>
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/2013/09/25/is-it-possible-to-hear-every-song" title="is it possible to hear every song?">&larr; Previous</a></li>
      
        <li><a href="/archive.html">Archive</a></li>
      
        <li class="next disabled"><a>Next &rarr;</a>
      
      </ul>
    </div>
    
  </div>
</div>


      </div>
      <hr>
      <footer>
        <p>&copy; 2013 Keyvan Fatehi
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>

    </div>

    
  </body>
</html>

<link rel="stylesheet" href="/assets/css/pygments.css">